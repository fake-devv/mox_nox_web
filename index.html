<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mox Nox</title>

<style>
:root {
  --bg: #0f1220;
  --card: #161a2f;
  --text: #eaeaf0;
  --muted: #9aa0c3;
  --lived: #4caf50;
  --remaining: #2a2f55;
  --accent: #7c83ff;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 40px;
  background: radial-gradient(circle at top, #1b1f3b, var(--bg));
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--text);
}

#app {
  background: var(--card);
  padding: 24px 32px 32px;
  border-radius: 16px;
  width: min(960px, 95%);
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
}

h1 {
  margin: 0 0 16px;
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* ---------- INPUT AREA ---------- */

#inputArea {
  position: sticky;
  top: 0;
  background: var(--card);
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  padding-bottom: 16px;
  z-index: 10;
}

input, select, button {
  background: #0f132b;
  color: var(--text);
  border: 1px solid #2b2f55;
  padding: 10px 12px;
  border-radius: 8px;
  font-size: 14px;
}

input::placeholder {
  color: var(--muted);
}

button {
  background: linear-gradient(135deg, var(--accent), #5a60ff);
  border: none;
  cursor: pointer;
  font-weight: 600;
}

button:hover {
  opacity: 0.9;
}

/* ---------- CALENDAR ---------- */

#calendarWrapper {
  margin-top: 20px;
  max-height: 360px;
  overflow-y: auto;
  padding-right: 6px;
  border-top: 1px solid #2b2f55;
}

#calendarWrapper::-webkit-scrollbar {
  width: 6px;
}

#calendarWrapper::-webkit-scrollbar-thumb {
  background: #3a3f70;
  border-radius: 4px;
}

#lifeCalendar {
  display: grid;
  gap: 3px;
  justify-content: center;
  min-width: 720px;
  padding-top: 16px;
}

.cell {
  width: 12px;
  height: 12px;
  border-radius: 3px;
}

.cell.lived {
  background: var(--lived);
}

.cell.remaining {
  background: var(--remaining);
}

/* ---------- LEGEND ---------- */

#legend {
  margin-top: 16px;
  display: flex;
  gap: 16px;
  font-size: 13px;
  color: var(--muted);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
}
</style>
</head>

<body>
<div id="app">
  <h1>Mox Nox</h1>

  <div id="inputArea">
    <input id="date_of_birth" placeholder="dd-MM-YYYY" />
    
    <select id="countrySelector">
      <option value="US">United States</option>
      <option value="UK">United Kingdom</option>
      <option value="IN">India</option>
      <option value="JP">Japan</option>
      <option value="DE">Germany</option>
      <option value="FR">France</option>
      <option value="CN">China</option>
      <option value="BR">Brazil</option>
      <option value="ZA">South Africa</option>
      <option value="RU">Russia</option>
    </select>

    <select id="unitSelector">
      <option value="years">Years</option>
      <option value="weeks" selected>Weeks</option>
      <option value="days">Days</option>
    </select>

    <button id="generateButton">Generate</button>
  </div>

  <div id="calendarWrapper">
    <div id="lifeCalendar"></div>
  </div>

  <div id="legend">
    <div class="legend-item">
      <span class="cell lived"></span> Lived
    </div>
    <div class="legend-item">
      <span class="cell remaining"></span> Remaining
    </div>
  </div>
</div>

<script>
const calendar = document.getElementById('lifeCalendar');

document.getElementById('generateButton').addEventListener('click', async () => {
  clearCalendar();

  const dob = document.getElementById('date_of_birth').value;
  const country = document.getElementById('countrySelector').value;
  const unit = document.getElementById('unitSelector').value;

  if (!dob) {
    alert('Please enter date of birth');
    return;
  }

  const lifeExpectancyYears = await getLifeExpectancy(country);
  const livedDays = getLivedDays(dob);
  const totalDays = Math.floor(lifeExpectancyYears * 365.25);

  renderCalendar(livedDays, totalDays, unit);
});

function renderCalendar(livedDays, totalDays, unit) {
  let livedUnits, totalUnits, columns;

  switch (unit) {
    case 'days':
      livedUnits = livedDays;
      totalUnits = totalDays;
      columns = 60;
      break;
    case 'years':
      livedUnits = livedDays / 365.25;
      totalUnits = totalDays / 365.25;
      columns = 25;
      break;
    default:
      livedUnits = livedDays / 7;
      totalUnits = totalDays / 7;
      columns = 52;
  }

  calendar.style.gridTemplateColumns = `repeat(${columns}, 12px)`;

  for (let i = 0; i < Math.floor(totalUnits); i++) {
    const cell = document.createElement('div');
    cell.className = 'cell ' + (i < livedUnits ? 'lived' : 'remaining');
    calendar.appendChild(cell);
  }
}

function getLivedDays(dobString) {
  const [day, month, year] = dobString.split('-').map(Number);
  const dob = new Date(year, month - 1, day);
  const today = new Date();
  return Math.floor((today - dob) / (1000 * 60 * 60 * 24));
}

async function getLifeExpectancy(country) {
  try {
    const res = await fetch(
      `https://api.worldbank.org/v2/country/${country}/indicator/SP.DYN.LE00.IN?format=json`
    );
    const data = await res.json();
    for (const row of data[1]) {
      if (row.value !== null) return Math.round(row.value);
    }
  } catch {}
  return 70;
}

function clearCalendar() {
  calendar.innerHTML = '';
}
</script>
</body>
</html>
